<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Request Permission</title>
    <style>
        body {
            font-family: sans-serif;
        }
    </style>
</head>
<body>
<script type="text/javascript">
    function buttonClicked() {
        let xhr = new XMLHttpRequest();
        let json = {
            "permissions": []
        };
        let health = document.getElementById("health").checked;
        if (health) {
            let healthRead = document.getElementById("healthRead").checked;
            let healthWrite = document.getElementById("healthWrite").checked;
            let healthShare = document.getElementById("healthShare").checked;
            let healthJson = {
                "category": "health",
                "read": healthRead,
                "write": healthWrite,
                "shareable": healthShare
            };
            json.permissions.push(healthJson)
        }
        let finance = document.getElementById("finance").checked;
        if (finance) {
            let financeRead = document.getElementById("financeRead").checked;
            let financeWrite = document.getElementById("financeWrite").checked;
            let financeShare = document.getElementById("financeShare").checked;
            let financeJson = {
                "category": "finance",
                "read": financeRead,
                "write": financeWrite,
                "shareable": financeShare
            };
            json.permissions.push(financeJson)
        }
        let pii = document.getElementById("pii").checked;
        if (pii) {
            let piiRead = document.getElementById("piiRead").checked;
            let piiWrite = document.getElementById("piiWrite").checked;
            let piiShare = document.getElementById("piiShare").checked;
            let piiJson = {
                "category": "PII",
                "read": piiRead,
                "write": piiWrite,
                "shareable": piiShare
            };
            json.permissions.push(piiJson)
        }
        xhr.open("POST", "http://localhost:8083/permissions", true);
        xhr.setRequestHeader('Content-Type', 'text/plain; charset=utf-8');
        xhr.onreadystatechange = () =>
        {
            if (xhr.readyState === 4 && xhr.status === 200) {
                console.log("OK");
                document.getElementById("response").textContent = "Permissions granted!";
                document.getElementById("responseText").textContent = xhr.responseText;
                document.getElementById("data-retrieval-button").style.display = "block";
            } else if (xhr.readyState === 4 && xhr.status === 401) {
                console.log("Rejected");
                document.getElementById("response").textContent = "Permissions denied!";
            }
        }
        console.log(JSON.stringify(json));
        xhr.send(JSON.stringify(json));
    }

</script>
<h1 style="color:green; text-align: center">Permissions</h1>
<h2>
    Please select the required permissions
</h2>
<p>Send Permissions</p>
<br>
<div id="selection">
        <input type="checkbox" id="health" value="health">Health :
        <input type="checkbox" id="healthRead" value="healthRead">Read
        <input type="checkbox" id="healthWrite" value="healthWrite">Write
        <input type="checkbox" id="healthShare" value="healthShare">Share<br>
        <input type="checkbox" id="finance" value="finance">Finance :
        <input type="checkbox" id="financeRead" value="healthRead">Read
        <input type="checkbox" id="financeWrite" value="healthWrite">Write
        <input type="checkbox" id="financeShare" value="healthShare">Share<br>
        <input type="checkbox" id="pii" value="pii">PII :
        <input type="checkbox" id="piiRead" value="healthRead">Read
        <input type="checkbox" id="piiWrite" value="healthWrite">Write
        <input type="checkbox" id="piiShare" value="healthShare">Share<br><br>
    <button onclick="buttonClicked()">Submit</button>
</div>
<div id="response"></div>
<div id="responseText"></div>
<button style="display:none" id="data-retrieval-button"><a href="getData.html">Get Data</a></button>
<noscript>Sorry, your browser does not support JavaScript!</noscript>

</body>
</html>